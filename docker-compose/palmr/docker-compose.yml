services:
  palmr:
    image: kyantech/palmr:v3.3.2-beta
    container_name: palmr
    restart: unless-stopped
    ports:
      - "5487:5487" # Web interface
      # - "3333:3333" # API (optional)
    environment:
      # Optional: Uncomment and configure as needed (if you don`t use, you can remove)
      # - ENABLE_S3=true # Set to true to enable S3-compatible storage
      - DISABLE_FILESYSTEM_ENCRYPTION=false # Set to false to enable file encryption
      - ENCRYPTION_KEY=9VPgKdY5VHILLWp3s7JlXMtqvPpGfnblH75pBuTvyQU=
      - PALMR_UID=1000 # UID for the container processes (default is 1000)
      - PALMR_GID=1000 # GID for the container processes (default is 1000)
      - SECURE_SITE=true # Set to true if you are using a reverse proxy
      - DEFAULT_LANGUAGE=en-US # Default language for the application (optional, defaults to en-US)
      # - PRESIGNED_URL_EXPIRATION=3600 # Duration in seconds for presigned URL expiration (optional, defaults to 3600 seconds / 1 hour)
      - DOWNLOAD_MAX_CONCURRENT=3 # Maximum simultaneous downloads (auto-scales if not set)
      - DOWNLOAD_MEMORY_THRESHOLD_MB=2048 # Memory threshold in MB before throttling (auto-scales if not set)
      - DOWNLOAD_QUEUE_SIZE=25 # Maximum queue size for pending downloads (auto-scales if not set)
      - DOWNLOAD_MIN_FILE_SIZE_GB=3.0 # Minimum file size in GB to activate memory management (default: 3.0)
      - DOWNLOAD_AUTO_SCALE=true # Enable auto-scaling based on system memory (default: true)
      - NODE_OPTIONS=--expose-gc # Enable garbage collection for large downloads (recommended for production)
      - NEXT_PUBLIC_UPLOAD_CHUNK_SIZE_MB=100 # Chunk size in MB for large file uploads (OPTIONAL - auto-calculates if not set)
    volumes:
      - ./palmr_data:/app/server
